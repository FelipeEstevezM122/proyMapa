<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubicación en Tiempo Real</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f0f1a;
            --panel: #1a1a2e;
            --border: rgba(255,255,255,0.15);
            --accent: #00ffaa;
            --accent2: #ff4d6d;
            --accent3: #7b2cbf;
            --text: #ffffff;
            --muted: #9d9db0;
            --glow: rgba(0, 255, 170, 0.3);
            --glow-pink: rgba(255, 77, 109, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Space Mono', monospace;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        #header {
            position: absolute;
            top: 0; left: 0; right: 0;
            z-index: 10;
            padding: 20px 28px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(to bottom, rgba(26,26,46,0.98), rgba(26,26,46,0.7), transparent);
            border-bottom: 2px solid var(--accent);
            box-shadow: 0 4px 20px rgba(0, 255, 170, 0.15);
        }

        #header h1 {
            font-family: 'Syne', sans-serif;
            font-weight: 800;
            font-size: 1.4rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--text);
            text-shadow: 0 0 10px var(--glow);
        }

        #header h1 span {
            color: var(--accent);
            background: linear-gradient(45deg, var(--accent), #4dffb5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 255, 170, 0.5);
        }

        #status {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            background: rgba(255,255,255,0.05);
            padding: 8px 16px;
            border-radius: 30px;
            border: 1px solid var(--accent);
            backdrop-filter: blur(5px);
        }

        #status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--muted);
            transition: all 0.3s;
        }

        #status-dot.active {
            background: var(--accent);
            box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        /* Map */
        #map {
            width: 100%;
            height: 100vh;
            filter: brightness(0.9) saturate(1.3) contrast(1.1);
        }

        /* Info Panel */
        #panel {
            position: absolute;
            bottom: 28px;
            left: 28px;
            z-index: 10;
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid;
            border-image: linear-gradient(45deg, var(--accent), var(--accent2), var(--accent3)) 1;
            border-radius: 8px;
            padding: 24px 28px;
            min-width: 280px;
            backdrop-filter: blur(16px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 30px var(--glow-pink);
            animation: slideUp 0.5s ease forwards;
        }

        #panel::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--accent), var(--accent2), var(--accent3));
            border-radius: 8px;
            z-index: -1;
            opacity: 0.5;
            filter: blur(8px);
        }

        .panel-label {
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 6px;
            text-shadow: 0 0 8px var(--glow);
        }

        .panel-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 16px;
            letter-spacing: 0.05em;
            background: linear-gradient(45deg, #fff, var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(255,77,109,0.3);
        }

        .panel-value:last-child {
            margin-bottom: 0;
        }

        .panel-value span {
            color: var(--accent);
            background: linear-gradient(45deg, var(--accent), #4dffb5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        #divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), var(--accent2), transparent);
            margin: 16px 0;
            filter: blur(1px);
        }

        /* Crosshair overlay on marker area */
        .mapboxgl-marker svg {
            filter: drop-shadow(0 0 15px var(--accent2)) drop-shadow(0 0 30px var(--accent3));
            animation: markerPulse 2s infinite;
        }

        @keyframes markerPulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 15px var(--accent2)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 25px var(--accent2)) drop-shadow(0 0 40px var(--accent3)); }
        }

        /* Mapbox controls */
        .mapboxgl-ctrl-group {
            background: rgba(26, 26, 46, 0.95) !important;
            border: 2px solid var(--accent) !important;
            border-radius: 8px !important;
            box-shadow: 0 0 15px var(--glow) !important;
        }

        .mapboxgl-ctrl-group button {
            background: transparent !important;
            filter: brightness(1.2);
        }

        .mapboxgl-ctrl-group button:hover {
            background: rgba(0, 255, 170, 0.2) !important;
        }

        /* Animate panel in */
        #panel {
            animation: slideUp 0.5s ease forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #hora-val {
            font-size: 1rem;
            background: linear-gradient(45deg, #fff, var(--accent3));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            background: var(--panel);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--accent), var(--accent2));
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>proy<span>Map</span></h1>
        <div id="status">
            <div id="status-dot"></div>
            <span id="status-text">Esperando...</span>
        </div>
    </div>

    <div id="map"></div>

    <div id="panel">
        <div class="panel-label"> Latitud</div>
        <div class="panel-value" id="lat-val"><span>—</span></div>
        <div class="panel-label"> Longitud</div>
        <div class="panel-value" id="lng-val"><span>—</span></div>
        <div id="divider"></div>
        <div class="panel-label"> Última actualización</div>
        <div class="panel-value" id="hora-val"><span>—</span></div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBTb0nY75TqcmLTDmPMKqDowOHVo-rC6BU",
        authDomain: "proyectomapa-f3b47.firebaseapp.com",
        projectId: "proyectomapa-f3b47",
        storageBucket: "proyectomapa-f3b47.firebasestorage.app",
        messagingSenderId: "669051924042",
        appId: "1:669051924042:android:d391f878dba8d4db3080b3"
    };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        mapboxgl.accessToken = 'pk.eyJ1IjoiZmVsaXBlLTAwMSIsImEiOiJjbW0xM3pxMTkwNXI1MnFvd28yMWk1OGcyIn0.qdom8scbUwLN_xHH8ySaAA';

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [0, 0],
            zoom: 12
        });

        map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

        // Crear un marker personalizado más vibrante
        const el = document.createElement('div');
        el.innerHTML = `
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="8" fill="#ff4d6d" stroke="#00ffaa" stroke-width="2"/>
                <circle cx="12" cy="12" r="4" fill="#00ffaa"/>
                <animate attributeName="r" values="8;10;8" dur="2s" repeatCount="indefinite" />
            </svg>
        `;
        
        const marker = new mapboxgl.Marker({ element: el })
            .setLngLat([0, 0])
            .addTo(map);

        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');

        const ubicacionRef = doc(db, "ubicaciones", "datas");

        onSnapshot(ubicacionRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                if (data && data.latitud !== undefined && data.longitud !== undefined) {
                    const latitud = parseFloat(data.latitud);
                    const longitud = parseFloat(data.longitud);

                    if (latitud >= -90 && latitud <= 90 && longitud >= -180 && longitud <= 180) {
                        marker.setLngLat([longitud, latitud]);
                        map.flyTo({ 
                            center: [longitud, latitud], 
                            speed: 0.8,
                            essential: true,
                            curve: 1.5
                        });

                        document.getElementById('lat-val').innerHTML = `<span>${latitud.toFixed(6)}°</span>`;
                        document.getElementById('lng-val').innerHTML = `<span>${longitud.toFixed(6)}°</span>`;

                        const now = new Date();
                        document.getElementById('hora-val').innerHTML = `<span>${now.toLocaleTimeString('es-ES')}</span>`;

                        statusDot.classList.add('active');
                        statusText.textContent = 'En vivo';
                    }
                }
            }
        });
    </script>
</body>

</html>
